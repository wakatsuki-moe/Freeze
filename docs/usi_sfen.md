# **Freeze将棋拡張 案**

* 2020-11-29：初版
* 2020-12-02：改定
* 2020-12-22：改定
* 2021-02-02：改定
* 2021-02-16：改定

---

* [**Freeze将棋拡張 案**](#freeze将棋拡張-案)
  * [基本;^^](#基本)
  * [sfen拡張](#sfen拡張)
    * [フリーズ残り回数指定```zxxZxx```](#フリーズ残り回数指定zxxzxx)
    * [フリーズ指定```zy Zy```](#フリーズ指定zy-zy)
  * [USIコマンド拡張](#usiコマンド拡張)
    * [各コマンド](#各コマンド)
      * [```FREEZE```](#freeze)
        * [```FREEZE```コマンド 詳細](#freezeコマンド-詳細)
      * [```FREEZENUM```](#freezenum)
        * [```FREEZENUM```コマンド 詳細](#freezenumコマンド-詳細)
  * [指し手表現](#指し手表現)
    * [フリーズ残り回数 ```zxxZxx```](#フリーズ残り回数-zxxzxx)
    * [駒 移動](#駒-移動)
      * [info で表示するか bestmoveで示すか pv等で示すか](#info-で表示するか-bestmoveで示すか-pv等で示すか)
        * [info](#info)
        * [bestmove](#bestmove)
  * [棋譜ファイル](#棋譜ファイル)
    * [Freeze将棋棋譜フォーマット](#freeze将棋棋譜フォーマット)
    * [Freeze将棋分岐棋譜 (変化：上記と同様)](#freeze将棋分岐棋譜-変化上記と同様)
    * [Freeze将棋局面](#freeze将棋局面)
    * [sfen](#sfen)

---

## 基本;^^

* Freeze将棋に関連する部分「以外」は極力本将棋に準ずるように努めます。

* 「F or f」は既にsfenである(6筋)ので　Freeze将棋関連は「Z or z」をで;^^
* 基本、最後に付加して、 無ければ考慮せずに本将棋で

---

## sfen拡張

基本形

      lnsgkgsnl/1r5b1/ppppppppp/9/9/9/PPPPPPPPP/1B5R1/LNSGKGSNL b - 1

### フリーズ残り回数指定```zxxZxx```

* zxx は、は先手の残り回数、Zxx は後手の残り回数
  * xxが無ければ0回 (zxのみ  Zxのみ も有効 。但し、xxが 0 もOK とします)
    * ↑ 保留中；^^
  * 全く無ければ 先後共に0回。 つまり、考慮しない(本将棋)
* 例：lnsgkg…sSNL b - 1  z3Z3
  * コノ局面で 先手２回、後手３回

### フリーズ指定```zy Zy```

* フリーズした```zy```
* yは駒種 :歩 と と、 飛車と龍等の区別あり
* l例：nsgkg……sSNL b - 1 zG z2Z3
  * コノ局面で、フリーズ金 先手２回、後手３回
* 全く無ければ考慮しない(本将棋)

* フリーズされた```Zy```
* yは駒種 :歩 と と、 飛車と龍等の区別のあり
  * 例：lnsgkg……sSNL w - 1 ZG z3Z2
    * コノ局面は、フリーズ金されていて 先手3回後手2回
* 全く無ければ考慮しない(本将棋)

---

## USIコマンド拡張

追加コマンド

* AI から GUI へ```FREEZE [ALLOW_FREEZE | CAN_FREEZE | OK | NONE]```
* GUI から AI へ```FREEZENUM [zNZN]```

### 各コマンド

#### ```FREEZE```

オプション

* ```NONE```
  * フリーズ将棋 を受け入れない
* ```ALLOW_FREEZE```
  * AIは、フリーズ将棋の指し手を受け入れる (が、AIからはフリーズの指し手に含めない)
* ```CAN_FREEZE```
  * AIは、フリーズ将棋の指し手を指す (が、相手からのフリーズの指し手を受け入れない)
* ```OK```
  *```ALLOW_FREEZE```かつ ```CAN_FREEZE```(フリーズ将棋を受け入れ、かつ、フリーズ将棋の指し手を指す)

##### ```FREEZE```コマンド 詳細

option コマンドの応答内へ含める意図です。
当然ですが、AIからの応答に含まれていなければ Freeze将棋 には未対応です;^^

```ALLOW_FREEZE```、```CAN_FREEZE```、```NONE```は デバグ目的でもあります。

また、AIが、指定された評価関数や定石等を読み込んだ時に、Freeze将棋に対応していないとの判断時に返答するようにとの
拡張の意図もあったりなかったり;^^

#### ```FREEZENUM```

オプション

* ```zNZM```
  * N は先手のフリーズ回数。M は後手のフリーズ回数
  * Nのみ  Mのみ も有効 。但し、MやMが 0 もOK とします
    * ↑ 保留中；^^
  *```FREEZENUM```を送信していなければ 先後共に0回 (本将棋)

##### ```FREEZENUM```コマンド 詳細

GUIがready 受信後にnewgame を送る前 に送信する意図です。

Freeze将棋 上は3回がルールだけど任意回と致します(例えば、下手0回、上手10回とか；^^)。

回数指定が省略されてた無い場合(```FREEZENUM```単体で送信)は、3回づつとします

上記、FREEZE 応答が無くて送信しても、Freeze将棋対応で無いAIの時は単に無視されるだけと思う;^^
(また、GUIでFreeze将棋に細かく対応していても、下記、指し手でエラーになると思う)

---

## 指し手表現

* 基本形その１

    position startpos
    position sfen xxxxxxxxxx

* 基本形その２

    position startpos moves xx
    position sfen xxxxxxxxxx moves xx

<!-- * 基本形その２ position sfen xxxxxxxxxx moves xx zG ・・・ z3Z3 -->

### フリーズ残り回数 ```zxxZxx```

* zxx は、は先手の残り回数、Zxx は後手の残り回数
  * xxが無ければ0回 (zxのみ  Zxのみ も有効 。但し、xxが 0 もOK とします)
    * ↑ 保留中；^^
  * 全く無ければ 先後共に0回。 つまり、考慮しない(本将棋)
  * 例
    * position startpos z3Z3
    * position startpos moves xx ・・・ z3Z3

### 駒 移動

* 基本形

       7g7f

* 7g7fzG
  * 7g7f 移動で金をフリーズ
* 7g7fZG
  * 金がフリーズの局面で、指し手7g7f
    * (オプション 要るかなぁ;^^)

#### info で表示するか bestmoveで示すか pv等で示すか

##### info

* info depth 1 seldepth 1 score cp 6055 nodes 137 nps 10538 time 13 pv ・・・5c6czG
  * 読みで 5c6c移動で金をフリーズ
* info depth 1 seldepth 1 score cp 6055 nodes 137 nps 10538 time 13 pv ・・・ 5c6czG・・・
  * 読みでの途中で 5c6c移動で金をフリーズ
* info depth 1 seldepth 1 score cp 6055 nodes 137 nps 10538 time 13 pv ・・・ 5c6cZG・・・
  * 読みでの途中で 金がフリーズの局面で思考し 5c6c移動
    * (オプション 要るかなぁ;^^)

##### bestmove

* bestmove 5c6czG
  * 金をフリーズ で 5c6c移動
* bestmove 5c6czG ponder xxxx
  * 金をフリーズ で 5c6c移動 で XXXを先読み
* bestmove 5c6c ponder xxxxzG
  * 5c6c移動 で 先読みで xxxx移動で 金をフリーズ
* bestmove 5c6cZG
  * 金がフリーズの局面で、指し手 5c6c移動
    * (オプション 要るかなぁ;^^)

---

## 棋譜ファイル

※ 当面は、kif/kifu形式  sfen(USI)形式 のみとします ^^;

* コメントでも良いかと
  * ダメ＞＜ 現状、将棋神 でだと、コメントは読み込むけど、表示せず、ファイルへ保存するとコメントは全て消えちゃう><
  * どうしようか；
    * なんとかする;^^

---

### Freeze将棋棋譜フォーマット

案：

    #KIF version=2.0 encoding=UTF-8
    # ---- Kifu for Windows V7 V7.41 棋譜ファイル ----
    開始日時：2019/05/29(水)
    表題：【テスト配信】綾瀬綾Presents新感覚将棋【Freeze！将棋（フリーズ将棋）】VS エクトリアちゃん
    棋戦：フリーズ将棋(テスト配信)
    場所：将棋ウォーズ
    手合割：平手　　
    先手：綾瀬綾
    後手：エクトリア
    手数----指手---------消費時間--
    *Freeze 先手 x回 後手 x回
      * 先頭のFreeze 必須 「回」等は変更するかもですが;^^
      *- 以前はは棋譜自体のコメントで # としていたけど
      *- 棋譜自体のコメントであってホントに無視されちゃう><
      *- 棋譜コメント扱い 他のGUIでも読める) はず
    1 ５六歩(57)   ( 0:00/00:00:00)
    2 ４二銀(31)   ( 0:00/00:00:00)
    3 ５八飛(28)   ( 0:00/00:00:00)
    4 ５二飛(82)   ( 0:00/00:00:00)
    5 ７六歩(77)   ( 0:00/00:00:00)
    6 ６二銀(71)   ( 0:00/00:00:00)
    7 ４八玉(59)   ( 0:00/00:00:00)
    8 ３二金(41)   ( 0:00/00:00:00)
    9 ３八玉(48)   ( 0:00/00:00:00)
    10 ７二金(61)   ( 0:00/00:00:00)

    ・・・
    40 ４六角(24)   ( 0:00/00:00:00)
    *z金 先手3回 後手2回                                    (← 金でフリーズ)
    41 ３七銀(38)   ( 0:00/00:00:00)
    *Z金 先手3回 後手2回                                    (← 金が被フリーズ)
    ・・・


    ・・・
    63 同　金(48)   (0:00/00:00:00) (先手3回 後手2回)      (←通常の指し手)
    64 ４五桂打     (0:00/00:00:00) (z金 先手3回 後手2回)  (←フリーズ )
    65 同　銀(56)   (0:00/00:00:00) (Z金 先手3回 後手2回)  (←被フリーズ)
    ・・・

### Freeze将棋分岐棋譜 (変化：上記と同様)

案：

    ・・・
    変化：4手
    4 同　銀(71)    (00:00 / 00:00:00)
    *z銀 先手3回 後手2回 (← 銀でフリーズ)
    5 ６一金打      (00:00 / 00:00:00)
    *Z銀 先手3回 後手2回 (← 銀が被フリーズ)
    ・・・

    ・・・
    変化：4手
    4 同　銀(71)    (00:00 / 00:00:00) (Z飛車 先手3回 後手2回)  (← 飛車が被フリーズ)
    ・・・

### Freeze将棋局面

案：

      #KIF version=2.0 encoding=UTF-8
      # KIF形式棋譜ファイル
      # Generated by Shogidokoro
      # Freeze 先手 x回 後手 y回               (← Freeze将棋 設定)
      後手の持駒：なし
      ９ ８ ７ ６ ５ ４ ３ ２ １
      +---------------------------+
      |v香v桂 ・v金 ・ ・ ・v桂v香|一
      | ・v玉v銀 ・ ・v飛 ・ ・ ・|二
      | ・ ・ ・v金v歩v銀v角v歩v歩|三
      |v歩v歩v歩v歩 ・v歩v歩 ・ ・|四
      | ・ ・ ・ ・ ・ ・ ・ ・ ・|五
      | ・ ・ 歩 歩 ・ ・ 歩 歩 歩|六
      | 歩 歩 桂 銀 歩 歩 ・ 銀 ・|七
      | 香 ・ ・ 角 飛 金 金 玉 香|八
      | ・ ・ ・ ・ ・ ・ ・ 桂 ・|九
      +---------------------------+
      先手の持駒：なし
      先手：人間
      後手：人間
      #(他のGUIでも読める)
      手数----指手---------消費時間--
      *Freeze z歩 先手 x回 後手 y回   (←コメント扱い フリーズの時         回数は上記の初期設定への上書き)
      *Freeze Z歩 先手 x回 後手 y回   (←コメント扱い フリーズ局面の時      回数は上記の初期設定への上書き)
      *Freeze z 先手 x回 後手 y回     (←コメント扱い フリーズ局面で無い時  回数は上記の初期設定への上書き)

### sfen

* 上記を参照を^^
